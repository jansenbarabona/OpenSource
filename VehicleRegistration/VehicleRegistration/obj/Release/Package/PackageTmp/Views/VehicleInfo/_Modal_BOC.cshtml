@using VehicleRegistration.Models
﻿@using VehicleRegistration.Tools
@model BOCModel

<style>
    
    div#ui-datepicker-div.ui-datepicker.ui-widget.ui-widget-content.ui-helper-clearfix.ui-corner-all {
        z-index: 2051 !important;
    }
</style>
<div class="modal fade" id="modal-BOC">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><label id="lblModalTitle">Certificate of Payment Information</label></h4>
            </div>
            <div class="modal-body">

                @{
                    Html.RenderPartial("_BatchHeader", Model.BatchHeader, new ViewDataDictionary() { TemplateInfo = new TemplateInfo() { HtmlFieldPrefix = "BOCInfo.BatchHeader" } });
                }

                <div class="row">
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.CPNumber)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-id-card"></i> </span>
                            </div>
                            @Html.TextBoxFor(m => m.CPNumber, new { placeholder = "CP Number", @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.CPNumber, "", new { @class = "" })
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.DateIssued1)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"> <i class="far fa-calendar-alt"></i> </span>
                            </div>
                            @Html.EditorFor(m => m.DateIssued1, new { htmlAttributes = new { @class = "form-control", placeholder = "Date Issued", @type = "date" } })
                        </div>
                        @Html.ValidationMessageFor(m => m.DateIssued1, "", new { @class = "" })
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.BOCFile)
                        <div class="input-group">
                            <a class="input-group-prepend" href="//:0" data-fancybox data-caption="&lt;b&gt;This image is BOC Certification OF Payment.">
                                <span class="input-group-text"><i class="fa fa-image"></i></span>
                            </a>
                            <div class="custom-file">
                                @Html.TextBoxFor(m => m.BOCFile,
           new
           {
               placeholder = "BOC File",
               //id = "file_SOC",
               @class = "custom-file-input",
               type = "file",
               accept = ".jpg,.jpeg,.png,.pdf"
           })
                                @Html.LabelFor(m => m.BOCFile, "Choose file",
           new
           {
               @class = "custom-file-label",
           })
                            </div>
                        </div>
                        @Html.ValidationMessageFor(m => m.BOCFile, "", new { @class = "" })
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.InformalEntryNumberEngine)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-id-card"></i> </span>
                            </div>
                            @Html.TextBoxFor(m => m.InformalEntryNumberEngine, new { placeholder = "Informal Entry Number", @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.InformalEntryNumberEngine, "", new { @class = "" })
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.CPNumber2)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-id-card"></i> </span>
                            </div>
                            @Html.TextBoxFor(m => m.CPNumber2, new { placeholder = "CP Number", @class = "form-control" })
                        </div>
                        @*@Html.ValidationMessageFor(m => m.CPNumber2, "", new { @class = "" })*@
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.DateIssued2)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"> <i class="far fa-calendar-alt"></i> </span>
                            </div>
                            @Html.EditorFor(m => m.DateIssued2, new { htmlAttributes = new { @class = "form-control", placeholder = "Date Issued", @type = "date" } })
                        </div>
                        @*@Html.ValidationMessageFor(m => m.DateIssued2, "", new { @class = "" })*@
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.BOC2File)
                        <div class="input-group">
                            <a class="input-group-prepend" href="//:0" data-fancybox data-caption="&lt;b&gt;This image is BOC Certification OF Payment.">
                                <span class="input-group-text"><i class="fa fa-image"></i></span>
                            </a>
                            <div class="custom-file">
                                @Html.TextBoxFor(m => m.BOC2File,
           new
           {
               placeholder = "BOC File",
               //id = "file_SOC",
               @class = "custom-file-input",
               type = "file",
               accept = ".jpg,.jpeg,.png,.pdf"
           })
                                @Html.LabelFor(m => m.BOC2File, "Choose file",
           new
           {
               @class = "custom-file-label",
           })
                            </div>
                        </div>
                        @*@Html.ValidationMessageFor(m => m.BOC2File, "", new { @class = "" })*@
                    </div>
                    <div class="form-group col-3">
                        @Html.LabelFor(m => m.InformalEntryNumberChassis)
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fa fa-id-card"></i> </span>
                            </div>
                            @Html.TextBoxFor(m => m.InformalEntryNumberChassis, new { placeholder = "Informal Entry Number", @class = "form-control" })
                        </div>
                        @Html.ValidationMessageFor(m => m.InformalEntryNumberChassis, "", new { @class = "" })
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" id="btn_boc" class="btn btn-primary" @*data-dismiss="modal" data-toggle="modal" data-target="#modal-BOC-Confirmation" *@>Update COP</button>
            </div>
        </div>
    </div>
</div>

<div id="modal-BOC-Confirmation" class="modal fade">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Are you sure you want to save?</h4>
            </div>
            <div id="modal-body-boc-confirmation" class="modal-body">
                <div class="row">
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.CPNumber): <label id="lbl_CP1"></label>
                    </div>
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.DateIssued1): <label id="lbl_DateIssued1"></label>
                    </div>
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.BOCFile): <label id="lbl_BOCFile"></label>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.CPNumber2): <label id="lbl_CP2"></label>
                    </div>
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.DateIssued2): <label id="lbl_DateIssued2"></label>
                    </div>
                    <div class="form-group col-4">
                        @Html.LabelFor(m => m.BOC2File): <label id="lbl_BOC2File"></label>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" id="btn_boc_confirmation_close" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" name="submit" value="BOC" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    //$(document).ready(function () {
    //    $(window).width(function () {
    //        if ($(this).width() < 770) {
    //            $("#batch_filter_adjust").css({ "position": "static", "margin-bottom": "10px", "z-index": "1" });
    //        } else {

    //            $("#batch_filter_adjust").css({ "position": "fixed", "margin-bottom": "10px", "z-index": "1" });
    //        }
    //    });
    //});
    $('#btn_boc').click(function () {
        $("#lbl_CP1").text($("#BOCInfo_CPNumber").val());
        $("#lbl_DateIssued1").text($("#BOCInfo_DateIssued1").val());
        $("#lbl_CP2").text($("#BOCInfo_CPNumber2").val());
        $("#lbl_DateIssued2").text($("#BOCInfo_DateIssued2").val());
        $("#lbl_BOCFile").text($("#BOCInfo_BOCFile").val().replace('C:\\fakepath\\', ''));
        $("#lbl_BOC2File").text($("#BOCInfo_BOC2File").val().replace('C:\\fakepath\\', ''));

        if ($("#vehiclelist_tbody tr").length == 0) {
            if (jQuery("form").valid()) {
                $("#modal-BOC").modal("hide");
                $("#modal-BOC-Confirmation").modal("show");
            }
        }
        else if ($("#vehiclelist_tbody tr").length > 0) {
            if (jQuery("form").valid()) {
                $("#modal-BOC").modal("hide");
                jQuery.noConflict();
                if (jQuery.fn.DataTable.isDataTable('#tbl_listofsummary')) {
                    jQuery('#tbl_listofsummary').DataTable().clear();
                    jQuery('#tbl_listofsummary').DataTable().destroy();
                }

                if ($("#summarry_thead tr").length == 0) {
                    $("#modal-body-boc-confirmation").append("" +
                    "<table id='tbl_listofsummary' class='table table-bordered table-striped table-hover' style='width:100%; max-width:100%;'>" +
                    "   <thead id='summarry_thead'>" +
                    "       <tr>" +
                    "           <th style='width:25%'>Make</th>" +
                    "           <th style='width:25%'>Model</th>" +
                    "           <th style='width:25%'>Engine</th>" +
                    "           <th style='width:25%'>Body</th>" +
                    "       </tr>" +
                    "   </thead>" +
                    "   <tbody id='summarry_tbody'>" +
                    "   </tbody>" +
                    "</table>");
                }

                $("#vehiclelist_tbody .checkbox_all:checkbox:checked").each(function () {
                    var tr = $(this).closest("tr");
                    var make = tr.find("td:eq(1)").text().trim();
                    var model = tr.find("td:eq(2)").text().trim();
                    var engine = tr.find("td:eq(5)").text().trim();
                    var body = tr.find("td:eq(6)").text().trim();
                    $("#tbl_listofsummary #summarry_tbody").append("" +
                    "<tr>" +
                    "    <td>" + make + "</td>" +
                    "    <td>" + model + "</td>" +
                    "    <td>" + engine + "</td>" +
                    "    <td>" + body + "</td>" +
                    "</tr>");
                });

                jQuery.noConflict();
                var summary_tbl = jQuery("#tbl_listofsummary").DataTable({
                    "scrollX": true,
                    "scrollY": true,
                    "info": false,
                    "lengthChange": false,
                    "searching": false,
                    "paging": false,
                    "order": [],
                    "dom":
                        "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'p><'col-sm-12 col-md-7'i>>",
                });

                $(document).on('shown.bs.modal', '.modal', function (e) {
                    summary_tbl.columns.adjust();
                });
                $("#modal-BOC-Confirmation").modal("show");

            }
        }
    });

    $("#btn_boc_confirmation_close").click(function () {
        $("#modal-BOC").modal("show");
    });
</script>
